---
- hosts: all
  gather_facts: false
  tasks:

  - name: Create a temp directory if it does not exist
    ansible.builtin.file:
      path: ~/temp/firefox-demo/
      state: directory
      mode: '0777'

  - name: Checkout the firefox-demo git repo
    ansible.builtin.git:
      repo: 'https://github.com/gregoryca/firefox-demo.git'
      dest: ~/temp/firefox-demo/

  - name: Create the srv directory if it does not exist
    ansible.builtin.file:
      path: ~/srv/
      state: directory
      mode: '0777'

  - name: copy git repo to remote server
    copy:
      src: ~/temp/firefox-demo
      dest: ~/srv/
      remote_src: yes
      
  - name: Run docker compose file
    become: True
    shell:
      cmd: "docker-compose up -d"
      chdir: /home/GregoryacDevOps/srv/firefox-demo/

  #########################################
  # Clean up temp folder after deployment #
  #########################################
  - name: Delete content & directory
    file:
      state: absent
      path: ~/temp/